generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model activity_logs {
  id        Int       @id @default(autoincrement())
  user_id   Int?
  action    String?
  details   String?
  timestamp DateTime? @default(now()) @db.Timestamp(6)
  users     users?    @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model categories {
  id            String  @id
  name          String?
  icon          String?
  tagline       String?
  display_order Int?    @default(0)
}

model customers {
  id         Int        @id @default(autoincrement())
  name       String
  email      String?
  phone      String?
  gstin      String?
  pan        String?
  address    String?
  city       String?
  state      String?
  state_code String?
  pincode    String?
  country    String?    @default("India")
  notes      String?
  created_at DateTime?  @default(now()) @db.Timestamp(6)
  updated_at DateTime?  @default(now()) @db.Timestamp(6)
  invoices   invoices[]
}

model email_templates {
  id         String    @id
  name       String
  subject    String?
  body       String?
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

model error_logs {
  id         Int       @id @default(autoincrement())
  error_type String?
  message    String?
  stack      String?
  context    String?
  resolved   Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

model invoice_items {
  id          Int      @id @default(autoincrement())
  invoice_id  Int
  description String
  hsn_code    String?
  quantity    Decimal? @default(1) @db.Decimal(10, 2)
  unit        String?  @default("Nos")
  rate        Decimal  @db.Decimal(10, 2)
  amount      Decimal  @db.Decimal(10, 2)
  invoices    invoices @relation(fields: [invoice_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model invoices {
  id               Int             @id @default(autoincrement())
  invoice_number   String          @unique
  type             String?         @default("manual")
  customer_id      Int?
  user_id          Int?
  subscription_id  Int?
  invoice_date     DateTime?       @default(dbgenerated("CURRENT_DATE")) @db.Date
  due_date         DateTime?       @db.Date
  place_of_supply  String?
  subtotal         Decimal?        @default(0) @db.Decimal(10, 2)
  discount_percent Decimal?        @default(0) @db.Decimal(5, 2)
  discount_amount  Decimal?        @default(0) @db.Decimal(10, 2)
  taxable_amount   Decimal?        @default(0) @db.Decimal(10, 2)
  cgst_rate        Decimal?        @default(9) @db.Decimal(5, 2)
  sgst_rate        Decimal?        @default(9) @db.Decimal(5, 2)
  igst_rate        Decimal?        @default(0) @db.Decimal(5, 2)
  cgst_amount      Decimal?        @default(0) @db.Decimal(10, 2)
  sgst_amount      Decimal?        @default(0) @db.Decimal(10, 2)
  igst_amount      Decimal?        @default(0) @db.Decimal(10, 2)
  total            Decimal?        @default(0) @db.Decimal(10, 2)
  amount_paid      Decimal?        @default(0) @db.Decimal(10, 2)
  balance_due      Decimal?        @default(0) @db.Decimal(10, 2)
  status           String?         @default("draft")
  payment_terms    String?
  notes            String?
  terms_conditions String?
  pdf_generated    Boolean?        @default(false)
  sent_at          DateTime?       @db.Timestamp(6)
  paid_at          DateTime?       @db.Timestamp(6)
  created_at       DateTime?       @default(now()) @db.Timestamp(6)
  updated_at       DateTime?       @default(now()) @db.Timestamp(6)
  invoice_items    invoice_items[]
  customers        customers?      @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  subscriptions    subscriptions?  @relation(fields: [subscription_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users            users?          @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model plans {
  id               String   @id
  name             String?
  price_original   Int?
  price_discounted Int?
  billing_cycle    String?
  features         String?
  razorpay_plan_id String?
  is_active        Boolean? @default(true)
  display_order    Int?
  category         String?  @default("ecommerce")
  price_color      String?
}

model schema_version {
  version     Int       @id
  applied_at  DateTime? @default(now()) @db.Timestamp(6)
  description String?
}

model settings {
  key   String  @id
  value String?
}

model subscriptions {
  id              Int        @id @default(autoincrement())
  user_id         Int?
  razorpay_sub_id String?
  plan_id         String?
  status          String?    @default("created")
  start_date      DateTime?  @default(now()) @db.Timestamp(6)
  renewal_date    DateTime?  @db.Timestamp(6)
  invoices        invoices[]
  users           users?     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id              Int             @id @default(autoincrement())
  google_id       String?         @unique
  email           String?         @unique
  name            String?
  phone           String?
  alternate_phone String?
  avatar_url      String?
  gstin           String?
  theme           String?
  address         String?
  city            String?
  state           String?
  pincode         String?
  created_at      DateTime?       @default(now()) @db.Timestamp(6)
  activity_logs   activity_logs[]
  invoices        invoices[]
  subscriptions   subscriptions[]
}
